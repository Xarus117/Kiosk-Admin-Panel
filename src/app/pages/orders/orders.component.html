<div class="p-6">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">Orders</h2>
      <p class="text-gray-500 text-sm mt-1">View and manage customer orders</p>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200">
    <p-table
      [value]="orders"
      [loading]="loading"
      [lazy]="true"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      (onLazyLoad)="onLazyLoad($event)"
      styleClass="p-datatable-sm"
    >
      <ng-template #header>
        <tr>
          <th>Order #</th>
          <th>User</th>
          <th>Status</th>
          <th>Items</th>
          <th>Total</th>
          <th>Created</th>
          <th class="w-28">Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-order>
        <tr>
          <td class="font-mono text-sm font-medium">{{ order.orderNumber || '#' + order.id }}</td>
          <td class="text-gray-600">{{ order.username || order.userId || 'â€”' }}</td>
          <td>
            <p-tag [value]="order.status" [severity]="getStatusSeverity(order.status)" />
          </td>
          <td class="text-gray-600">{{ order.items?.length ?? 0 }}</td>
          <td class="font-medium">{{ order.total | currency }}</td>
          <td class="text-gray-500 text-sm">{{ order.createdAt | date:'short' }}</td>
          <td>
            <div class="flex gap-1">
              <p-button icon="pi pi-sync" [rounded]="true" [text]="true" size="small" pTooltip="Update Status" (onClick)="openStatusPanel(order)" />
              <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" size="small" pTooltip="Delete" (onClick)="confirmDelete(order)" />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="7" class="text-center text-gray-400 py-10">No orders found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

</div>

<!-- Status Update Drawer -->
<p-drawer [(visible)]="drawerVisible" header="Update Order Status" position="right" styleClass="!w-[380px]">
  @if (selectedOrder) {
    <div class="flex flex-col gap-4 p-2">

      <div class="bg-gray-100 rounded-lg p-4">
        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Order</p>
        <p class="font-mono font-bold text-lg">{{ selectedOrder.orderNumber || '#' + selectedOrder.id }}</p>
        <p class="text-sm text-gray-500 mt-1">Current: <span class="font-medium">{{ selectedOrder.status }}</span></p>
      </div>

      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium text-gray-700">New Status</label>
        <p-select [(ngModel)]="newStatus" [options]="statusOptions" optionLabel="label" optionValue="value" placeholder="Select status" class="w-full" />
      </div>

      <div class="flex gap-2 pt-2">
        <p-button label="Update" icon="pi pi-check" (onClick)="updateStatus()" class="flex-1" />
        <p-button label="Cancel" icon="pi pi-times" severity="secondary" [outlined]="true" (onClick)="drawerVisible = false" class="flex-1" />
      </div>

    </div>
  }
</p-drawer>
